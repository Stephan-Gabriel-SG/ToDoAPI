<!doctype html>
<html lang="en" class="has-navbar-fixed-top">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <title>TodoList</title>
  </head>
  <body>
    <div id="root">
      <nav
        class="navbar has-shadow"
        role="navigation"
        aria-label="main navigation"
      >
        <div class="navbar-brand">
          <a class="navbar-item" href="/">
            <h1 class="title is-4">TodoList</h1>
          </a>
          <a
            role="button"
            class="navbar-burger"
            aria-label="menu"
            aria-expanded="false"
            data-target="navbarBasicExample"
          >
            <i class="bx bx-menu bx-sm"></i>
          </a>
        </div>

        <div class="navbar-menu">
          <div class="navbar-end">
            <a class="navbar-item" href="/">Accueil</a>
            <a class="navbar-item" href="/docs.html">Documentation</a>
          </div>
        </div>
      </nav>
      <div class="container">
        <!-- <div class="field"> -->
        <div class="field has-addons">
          <p class="control has-icons-left is-expanded">
            <input
              id="search"
              type="text"
              class="input is-rounded"
              placeholder="Rechercher une t√¢che via mot cl√© titre ou description"
            />
            <span class="icon is-left">
              <i class="bx bx-search"></i>
            </span>
          </p>
          <p class="control">
            <button class="button is-info">Rechercher</button>
          </p>
        </div>

        <div class="filter box">
          <h2 class="title is-5">Filtres</h2>

          <!-- Filtrer par priorit√© -->
          <div class="field">
            <label class="label">Priorit√©</label>
            <div class="control">
              <div class="select">
                <select id="priorityFilter">
                  <option value="">-- Choisir --</option>
                  <option value="high">Haute</option>
                  <option value="medium">Moyenne</option>
                  <option value="low">Basse</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Filtrer par tag -->
          <div class="field">
            <label class="label">Tag</label>
            <div class="control">
              <input
                class="input is-rounded"
                type="text"
                id="tagFilter"
                placeholder="Ex: travail"
              />
            </div>
          </div>

          <!-- Favoris -->
          <div class="field">
            <label class="checkbox">
              <input type="checkbox" id="favoriteFilter" />
              Favoris
            </label>
          </div>

          <!-- Compl√©t√©s -->
          <div class="field">
            <label class="checkbox">
              <input type="checkbox" id="completedFilter" />
              Compl√©t√©s
            </label>
          </div>

          <button class="button is-link" onclick="applyFilters()">
            Appliquer
          </button>
        </div>
        <!-- </div> -->

        <h1 class="title is-3">Listes des t√¢ches</h1>
        <div id="todos" class="columns is-multiline is-variable is-4"></div>
      </div>
    </div>
  </body>
  <script type="text/javascript" async="true">
    // Formatage formatISODate
    function formatISODate(isoString) {
      const date = new Date(isoString);

      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0'); // les mois commencent √† 0
      const year = date.getFullYear();

      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');

      return `${day}-${month}-${year} ${hours}:${minutes}`;
    }

    // API REQUEST
    const api_url = 'http://localhost:3000/todos';

    // CREATE - Cr√©er un nouvel √©l√©ment
    async function createTodo(todoData) {
      try {
        const response = await fetch(api_url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(todoData),
        });

        if (!response.ok) {
          throw new Error(`Erreur HTTP: ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error('Erreur lors de la cr√©ation:', error);
        throw error;
      }
    }

    // READ - Lire tous les √©l√©ments
    async function getAllTodos() {
      try {
        const response = await fetch(api_url);

        if (!response.ok) {
          throw new Error(`Erreur HTTP: ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error('Erreur lors de la r√©cup√©ration des todos:', error);
        throw error;
      }
    }

    // READ - Lire un √©l√©ment sp√©cifique par ID
    async function getTodoById(id) {
      try {
        const response = await fetch(`${api_url}/${id}`);

        if (!response.ok) {
          throw new Error(`Erreur HTTP: ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error(`Erreur lors de la r√©cup√©ration du todo ${id}:`, error);
        throw error;
      }
    }

    // UPDATE - Mettre √† jour un √©l√©ment
    async function updateTodo(id, updatedData) {
      try {
        const response = await fetch(`${api_url}/${id}`, {
          method: 'PUT', // ou 'PATCH' selon votre API
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(updatedData),
        });

        if (!response.ok) {
          throw new Error(`Erreur HTTP: ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error(`Erreur lors de la mise √† jour du todo ${id}:`, error);
        throw error;
      }
    }

    // DELETE - Supprimer un √©l√©ment
    async function deleteTodo(id) {
      try {
        const response = await fetch(`${api_url}/${id}`, {
          method: 'DELETE',
        });

        if (!response.ok) {
          throw new Error(`Erreur HTTP: ${response.status}`);
        }

        // Certaines APIs ne retournent rien pour DELETE, d'autres retournent l'objet supprim√©
        return response.status === 204 ? null : await response.json();
      } catch (error) {
        console.error(`Erreur lors de la suppression du todo ${id}:`, error);
        throw error;
      }
    }

    /*************  ‚ú® Windsurf Command ‚≠ê  *************/
    /**
     * Affiche la liste des t√¢ches pass√©es en param√®tre
     * en tant que carte Bulma dans le conteneur HTML
     * d'id "todos"
     *
     * @param {todoEntry[]} todoList - La liste des t√¢ches √† afficher
     */
    /*******  cbd4a2e5-889a-4600-a6f3-a436bc4d1357  *******/
    function renderTodos(todoList) {
      const container = document.getElementById('todos');
      container.innerHTML = '';

      todoList.forEach((todo) => {
        const card = document.createElement('div');
        card.className = 'card mb-4';
        card.id = `todo-${todo.id}`;
        card.innerHTML = `
      <header class="card-header">
        <p class="card-header-title">
          <i class='bx bx-list-ul bx-sm' style="margin-right:8px;"></i>
          ${todo.title}
        </p>
        <div class="card-header-icon">
          ${todo.isFavorite ? "<i class='bx bxs-star' style='color: gold;'></i>" : ''}
        </div>
      </header>

      <div class="card-content">
        <div class="content">
          ${todo.description ? `<p><strong>Description:</strong> ${todo.description}</p>` : ''}
          <p><strong>Priorit√©:</strong> ${priorityIcon(todo.priority)} ${todo.priority}</p>
          ${todo.tags?.length ? `<p><strong>Tags:</strong> ${todo.tags.map((tag) => `<span class="tag is-info">${tag}</span>`).join(' ')}</p>` : ''}
          <label class="checkbox mt-2">
            <input type="checkbox" ${todo.isCompleted ? 'checked' : ''}> Compl√©t√©e
          </label>
          <p class="is-size-7 mt-2 has-text-grey">Cr√©√©e le ${formatISODate(todo.createdAt)} ‚Ä¢ Modifi√©e le ${formatISODate(todo.updatedAt)}</p>
        </div>
      </div>

      <footer class="card-footer">
        <a href="#" class="card-footer-item has-text-info"><i class='bx bx-edit-alt'></i> Modifier</a>
        <a href="#" class="card-footer-item has-text-danger"><i class='bx bx-trash'></i> Supprimer</a>
      </footer>
    `;

        container.appendChild(card);
      });
    }

    // Fonction utilitaire pour afficher une ic√¥ne selon la priorit√©
    function priorityIcon(p) {
      switch (p) {
        case 'high':
          return 'üî¥';
        case 'medium':
          return 'üü†';
        case 'low':
          return 'üü¢';
        default:
          return '‚ö™';
      }
    }

    let todoList = [];
    getAllTodos().then((response) => {
      if (response.success) {
        todoList = response.data;
        renderTodos(todoList);
      }
    });
  </script>
</html>
